## 实验 7：混态 MPDO / POVM 的 Hankel 秩（定理 12.1）

### 1. 目标回顾

**理论：**
 在 Liouville 向量化视角下：

- 初态 $\rho_0$ 有一个 MPDO（或等价的 MPO）表示，其向量化 $|\rho_0\!\rangle\!\rangle$ 是一个 MPS，键维记作 $\chi_\rho$；

- POVM $\{M_x\}$ 也可以用一个“测量张量网络”表示，其在 Liouville 空间里的键维记作 $\chi_M$；

- 对长度 $L$ 的串 $x$，
  $$
  p(x)=\mathrm{Tr}(M_x\rho_0)
  = \langle\!\langle M_x|\rho_0\!\rangle\!\rangle
  $$
  的张量网络跨任意割的有效维度至多是 $\chi_\rho\chi_M$，所以

$$
\operatorname{rank}(H_p)\ \le\ \chi_\rho\chi_M.
$$

特殊情况：若测量是逐位可分的本征测量（如计算基），则 $\chi_M=1$，因此
$$
\operatorname{rank}(H_p)\le\chi_\rho.
$$
**实验目标：**

1. 在混态 + POVM 场景下数值验证：
   - 对一批随机 MPDO（键维 $\chi_\rho\in\{2,4\}$）和随机 POVM（测量网络键维 $\chi_M$），构造 Hankel 矩阵 $H_p$，验证其数值秩不超过 $\chi_\rho\chi_M$；
   - 对逐位可分测量（$\chi_M=1$）验证 $\operatorname{rank}(H_p)\le\chi_\rho$。
2. 看“典型性”：
   - 在随机参数化下，$\operatorname{rank}(H_p)$ 是否通常接近上界 $\chi_\rho\chi_M$（在维度允许的情况下）；
   - 有效秩（奇异值谱）是否也集中在上界附近。

------

## 2. 实验设置概览

### 2.1 基本参数

- 单体物理维度：$d=2$（qubit），也可以选 $d=3$ 做对比；
- 序列长度：$L\in\{6,8,10\}$；
- Hankel 切分点：$t_*=\lfloor L/2\rfloor$，
  - 前缀集合：$P=\Sigma^{t_*}$，
  - 后缀集合：$S=\Sigma^{L-t_*}$，
  - 所以 Hankel 大小为 $|P|\times |S| = d^{t_*}\times d^{L-t_*}$；
- MPDO 键维：$\chi_\rho\in\{2,4\}$；
- POVM 测量网络键维：$\chi_M\in\{1,2,4\}$（$\chi_M=1$ 是逐位投影的特例）。

**注意：**
 为了看见 $\chi_\rho\chi_M$ 上界的“紧性”，我们要保证
$$
|P|,\ |S|\ \ge\ \chi_\rho\chi_M,
$$
否则 rank 还会受 $|P|,|S|$ 限制（$\operatorname{rank}(H_p)\le \min(|P|,|S|)$）。
 在 $d=2,L=8$ 时，$t_*=4\Rightarrow |P|=|S|=2^4=16$，可以容纳 $\chi_\rho\chi_M\le 16$ 的各种组合。

------

## 3. 混态 MPDO 的构造（$\chi_\rho$）

这里有很多实现路线，你原文里也提了“finite-temperature MPS 或随机噪声态”。可以给出两种主流方法，实际实现时挑自己熟悉的一种即可。

### 3.1 方法 A：有限温度态（thermal MPDO）

1. 选一个简单的局域哈密顿量，例如：
   $$
   H = \sum_{t=1}^{L-1} J\,\sigma^z_t\sigma^z_{t+1} + h\sum_{t}\sigma^x_t,
   $$
   用标准的 1D 模型（Ising / Heisenberg 均可）。

2. 用 TEBD / imaginary-time evolution（标准 MPO 技术）构造 $\rho(\beta)\propto e^{-\beta H}$ 的 MPDO 近似，并在演化过程中**截断 MPO 键维到 $\chi_\rho$**。

3. 对得到的 MPDO 做一次归一化：$\rho_0 = \rho/\mathrm{Tr}\rho$。

此时我们定义“MPDO 键维”为算法中使用的最大 MPO bond dimension $\chi_\rho$。

### 3.2 方法 B：随机噪声态（channel 生成的 MPDO）

1. 初始态取 $\rho^{(0)} = |0\rangle\langle 0|^{\otimes L}$（可写成 bond‑1 的 MPDO）。
2. 构造若干层近邻噪声通道：
   - 例如每层对每对相邻比特施加随机 CPTP 映射（用 2–3 个 Kraus 算子，张量网络实现为 bond $\chi_\rho$ 的 MPO）；
   - 或者每层先用随机浅层双比特 unitary（MPO）纠缠，再加局域退相干（对角 Kraus）。
3. 使用 MPO 格式逐层更新 $\rho^{(\ell)} = \mathcal E^{(\ell)}(\rho^{(\ell-1)})$，并在每步后将 MPO 截断到最大 bond 维 $\chi_\rho$。
4. 最终得到 $\rho_0=\rho^{(L_{\rm layers})}$。

这类“随机噪声链”的混态非常典型，且容易得到任意给定的 MPDO 键维 $\chi_\rho$。

> 对实验目的来说，我们只需要「$\rho_0$ 的 Liouville 向量化 MPS 键维 ≈ $\chi_\rho$」，具体物理含义可以不苛求到极致。

------

## 4. POVM 测量网络的构造（$\chi_M$）

我们需要两类 POVM：

### 4.1 类 1：逐位投影（$\chi_M=1$）

每个 site 上使用计算基测量：

- 单位点 POVM 元素：
  $$
  \{ |0\rangle\langle 0|,\ |1\rangle\langle 1|\},
  $$

- 整体 POVM 元素为：
  $$
  M_x = |x_1\cdots x_L\rangle\langle x_1\cdots x_L|,\quad x\in\{0,1\}^L.
  $$

在 TN 视角中，这就是一个**逐位可分**的测量网络，其 Liouville 键维 $\chi_M = 1$。

### 4.2 类 2：浅层纠缠 POVM（$\chi_M>1$）

一个自然的构造是：

1. 先作用一个浅层测量网络 $U_{\rm meas}$（brickwall 随机两比特 unitary 电路），表示为 bond‑$\chi_U$ 的 MPO（例如深度 1-2，bond 维一般 $\le 4$）。

2. 然后在输出端逐位做计算基测量。整体 POVM 元素为：
   $$
   E_x = U_{\rm meas}^\dagger |x\rangle\langle x| U_{\rm meas}.
   $$

在 Liouville 空间中，$U_{\rm meas}$ 对应一个 MPS/ MPO，键维记作 $\chi_M \approx\chi_U^2$（向量化后）。实际操作上可以直接把 $E_x$ 写成一个“测量 MPO”，然后把其向量化 MPS 的 bond 维作为 $\chi_M$。

实验中可以选几种典型 $\chi_M$：

- 浅层一层 gate → $\chi_M\approx 2$；
- 深度 2 的 brickwall → $\chi_M\approx 4$；

并通过 TN 规范化 + 截断控制到目标范围。

> 物理上这是“先做少量纠缠，再测量”的 POVM，足够体现 $\chi_M>1$ 的情形和 rank 上界的变化。

------

## 5. Hankel 矩阵的构造与数值秩

### 5.1 概率分布 $p(x)$ 的计算

对给定 $L$、MPDO $\rho_0$ 和 POVM $\{E_x\}$：

- 对任意二进制串 $x\in\{0,1\}^L$：
  $$
  p(x) = \mathrm{Tr}(E_x\rho_0)
  $$

- 实现上可以用 TN contraction：

  - 对逐位投影：$p(x)$ 就是 $\rho_0$ 在 $|x\rangle\langle x|$ 基下的对角元，可以直接通过 MPO 的局域 contraction 得到；
  - 对纠缠 POVM：用 MPDO + 测量 MPO 进行 contraction 即可。

对每个随机实例，我们枚举所有 $x\in\Sigma^L$（如 L≤10 时 1024 个点完全可行）并存下 $p(x)$。

### 5.2 Hankel $H_p$ 的构造

选定切分点 $t_*=\lfloor L/2\rfloor$：

- 前缀集合：$P=\Sigma^{t_*}$；
- 后缀集合：$S=\Sigma^{L-t_*}$。

对每个 $u\in P, v\in S$：

- 拼接 $x=uv$，定义
  $$
  H_p(u,v) = p(uv).
  $$

这样得到一个 $|P|\times |S|$ 的 Hankel 矩阵 $H_p$。
 只要保证 $|P|,|S|\ge\chi_\rho\chi_M$，理论上 rank 上界才有机会显式体现为 $\chi_\rho\chi_M$。

### 5.3 数值秩与有效秩

对每个 $H_p$ 做 SVD：
$$
H_p = U\Sigma V^\top,\quad
\Sigma=\mathrm{diag}(\sigma_1\ge\sigma_2\ge\cdots).
$$
**数值秩定义：**

- 选定相对阈值 $\tau$（例如 $10^{-10}$）：
  $$
  \operatorname{rank}_\tau(H_p)
  = \#\{i:\sigma_i\ge\tau\,\sigma_1\}.
  $$

**有效秩（可选）：**

- 也可以看“绝对阈值”意义下的有效秩：
  $$
  \operatorname{rank}_\varepsilon(H_p)
  = \#\{i:\sigma_i\ge\varepsilon\}
  $$
  例如 $\varepsilon$ 取 $10^{-6},10^{-8}$ 等。

实验中我们关注：

- 真正的“数值秩” $\operatorname{rank}_\tau(H_p)$ 与 $\chi_\rho\chi_M$ 的关系；
- 有效秩 vs $\chi_\rho\chi_M$ 的统计分布。

------

## 6. 实验流程与指标

### 6.1 批量随机实验

对每个配置：

- 物理维度 $d=2$；
- 长度 $L\in\{6,8,10\}$（至少选一个，比如 L=8）；
- MPDO 键维 $\chi_\rho\in\{2,4\}$；
- POVM 键维 $\chi_M\in\{1,2,4\}$；

执行以下步骤：

1. 重复 $N_{\rm inst}$ 次（例如 30–50 个随机实例）。
2. 每次实例中：
   1. 随机生成一个 MPDO $\rho_0$（方法 A/B，截断 bond 维 $\chi_\rho$）；
   2. 随机生成一个 POVM 网络：
      - 若 $\chi_M=1$：逐位投影；
      - 若 $\chi_M>1$：随机浅层 unitary + 本征测量，保证测量网络的 Liouville bond 维在目标范围内。
   3. 枚举所有 $x\in\Sigma^L$，计算 $p(x)$；
   4. 选定切分点 $t_*$，构造 Hankel $H_p$；
   5. SVD，记录数值秩 $\operatorname{rank}_\tau(H_p)$ 以及若干有效秩（如 $\operatorname{rank}_\varepsilon(H_p)$）。

### 6.2 指标 1：rank(H_p) vs $\chi_\rho\chi_M$

**硬性上界验证：**

- 对每个实例检查：
  $$
  \operatorname{rank}_\tau(H_p)\ \le\ \min\big\{|P|,|S|,\ \chi_\rho\chi_M\big\}
  $$
  （其中 $|P|$,$|S|$ 是维度本身）。

- 若出现超过 $\chi_\rho\chi_M$ 的情况，十有八九是数值阈值或 SVD 精度的问题，需要调节 $\tau$ 或检查实现。

**统计图：**

- 对每个配置 ($\chi_\rho,\chi_M$)，画一个直方图或箱型图：
  - 横轴：实例编号或 rank 值；
  - 纵轴：$\operatorname{rank}_\tau(H_p)$；
  - 画一条水平线在 $\chi_\rho\chi_M$ 处表示理论上界。

**预期：**

- 在所有实例上，$\operatorname{rank}_\tau(H_p)$ 从不超过 $\chi_\rho\chi_M$；
- 当 $|P|,|S|$ 足够大时（例如 L=8，$|P|=|S|=16$），大部分随机实例的 Hankel 秩会**接近** $\chi_\rho\chi_M$，验证“上界通常是紧的”。

### 6.3 指标 2：可分测量特例（$\chi_M=1$）

单独统计“逐位投影 POVM” 的情形：

- 对 $\chi_M=1$ 的所有实例，绘制 $\operatorname{rank}_\tau(H_p)$ 的分布，并对比 $\chi_\rho$；

- 这里理论上界变成：
  $$
  \operatorname{rank}(H_p)\le \chi_\rho.
  $$

**预期：**

- 在 $\chi_M=1$ 情形下，数值秩 $\operatorname{rank}_\tau(H_p)$ 从不超过 $\chi_\rho$；
- 对“随机 MPDO + 可分测量”，典型情况下 $\operatorname{rank}_\tau(H_p)$ 会接近 $\chi_\rho$（就像纯态 MPS 情形 rank 接近 D 或 D²）。

### 6.4 指标 3：有效秩与“接近上界”的程度

为了看得更细一点，可以考察奇异值谱，定义一种“软”的有效秩，比如：

- 归一化奇异值：$\tilde\sigma_i = \sigma_i/\sigma_1$；

- 对给定阈值 $\eta\in\{10^{-2},10^{-3}\}$：
  $$
  r_{\rm eff}(\eta) = \#\{i:\tilde\sigma_i\ge\eta\}.
  $$

然后统计：

- $r_{\rm eff}(\eta)$ 在各实例中的分布，相对于 $\chi_\rho\chi_M$；
- 看看大量实例是不是有 $r_{\rm eff}$ 靠近 $\chi_\rho\chi_M$，还是奇异值谱有明显衰减（比如有效秩远小于理论上界，表示混态 + POVM 结构自身就引入了额外的低秩结构）。

**预期：**

- 对“随机 MPDO + 随机纠缠 POVM”（$\chi_M>1$）大多数实例，$r_{\rm eff}(\eta)$ 会向 $\chi_\rho\chi_M$ 聚集 ⇒ 说明上界在“典型模型”下是近紧的；
- 对“逐位测量”（$\chi_M=1$），$r_{\rm eff}(\eta)$ 集中在 $\chi_\rho$ 以下，验证特例的 rank 上界。

------

## 7. 总结 & 写在论文里的话

可以在第 12 章实验小节中这样总结：

> We verify Theorem 12.1 in the mixed-state setting by generating random MPDOs with bond dimension $\chi_\rho\in\{2,4\}$ and random POVMs implemented by shallow measurement tensor networks with bond dimension $\chi_M\in\{1,2,4\}$. For each configuration, we enumerate the induced distribution $p(x)=\mathrm{Tr}(M_x\rho_0)$ over length-$L$ strings, construct the corresponding probability Hankel matrix $H_p(P,S)$, and compute its numerical rank via SVD.
>
> Across all instances, the observed Hankel ranks never exceed $\chi_\rho\chi_M$ (up to numerical tolerance), confirming the general upper bound. Moreover, for sufficiently large prefix/suffix sets, the empirical ranks typically saturate the bound $\chi_\rho\chi_M$, indicating that this upper bound is essentially tight for generic MPDO+POVM parametrizations. In the special case of site-wise projective measurements ($\chi_M=1$), the Hankel rank is always bounded by $\chi_\rho$, in accordance with the pure-MPS limit and the specific corollary of Theorem 12.1.

这样，前面纯态 MPS 的 rank ≤ D²（实验 1）＋这里混态 MPDO 的 rank ≤ χρ χM（实验 7），就把你整篇文章“Born–Hankel–TN”的秩故事完全闭合了：从纯态到混态，从 projective measurement 到 general POVM，都有实证支撑。